<style lang="less">
.container {
  background-color: #eee;
}
.swiperarea {
  width: 100%;
}
.swiper{
  height:400rpx;
}
.slide-image {
  width: 100%;
  height: 100%;
}
.slide-image:after {
  content: "";
  position: absolute;
  bottom: 0;
  width: 100%;
  color: #fff;
  padding: 50px 20px;
  background-image: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.7));
}
.swiper-item {
  position: relative;
}
.title_en {
  position: absolute;
  bottom: 0;
  color: #fff;
  z-index: 2;
  padding: 20px;
}
.line {
  // width: 90%;
  // height: 2rpx;
  background: #aaa;
  margin: 15rpx;
}
.cards-area {
  width: 100%;
  .date{
    color: #666;
    text-align: center;
    margin-bottom: 10rpx;
    opacity: .8;
    &:before{
      position: absolute;
      content: "————";
      left:450rpx;
      right:0;
    }
    &:after{
      position: absolute;
      content: "————";
      left:0;
      right:450rpx;
    }
  }
}
.info{
  color:gray;
  opacity:.8;
  margin-bottom: 20rpx;
  &.loading{
    width: 70rpx;
    height: 70rpx;
  }

  .btn{
    width: 80rpx;
    height: 45rpx;
  }
}

@font-face {
    font-family: 'iconfont';
    src: url(data:application/font-woff2;charset=utf-8;base64,d09GMgABAAAAAAWEAA0AAAAACrwAAAUtAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP0ZGVE0cGh4GVgCCWhEICohohyELEAABNgIkAxgEIAWFCAdSG/4IUZQwTjbZR0K5cVmwSJKkjSsBxdt8eLp9f+7MpKlHu6mFehDrf9dC1VIIXwAPb7v3/WPW5UqSFRP6VdObEpgp4f7nmOmicLhh/QUPbIIj+otMi6YO4AnsDYe7ToymAy07OsZ7h3hrdXXSlfA940oACADGHUFCADAVOOYrD00AEoAjgELQ+AgGQAFI/kWWowfqpB4AlsHXk19sCAEKL6FsW70VNCLb6HuaVv6vxCoRwAECYYBGs3uKKDUS5ucYyQCWEIUy+iz87PHnp///H8L3tstlp0uicxUILUcGgJAFOgAU8jsJ+BtokCatoYhRYBMtD3YCsgPkAwAAwxLxf/PwMYSTg8hO4iaWiCwkjhKJxEnk7Ciytnbo2MGy6hN7DoDNolq37xzLQnKAqwf2nNjhyMokUlZ9a9++dYRw6j3KvZr9qn3cGuc1zs6rV2u1YgvNflfdpk2uzUS1fv1usVhzFm4ysdlMTCaZwSDdYIyQao3cVaODXMzJzWanTt2z0FOJifKLxgK5wSRTmeVGI2cwcLLb5iwu/kT8AoNBajRyZrPcZJLNPlHKKrpp9LFPmDSG2sCWOrsY7RqzbHdrZM3m9uNzmqVn3TL5bqduc4uhRaMnZG/C6eeqZ4kngolKp14NqmrlOy8qL6gvqS5zGie9Xqez3xHaA7TUakcde+KJ8umi02FQahsqqwewLzFH26S86fRzL3rTs0RLckJ3auPTBBm9/nKQ1c6LLtSaC/6Wuy5NKMoAuYRSK7aq+WoqnbPnFtc627Izjq7lyzHLYvO4wvNlxamtr8ajyyP/s+AjH2SGz5wOm8myt/4pdMZy93CmxNrV2sW8ac3EGJebM+rolf65ZZeT/PXyF1bVzR3+RFz00XqHC16LAz9GXI78B1FJMLX87JUVNIMy+jpB/HiYfsumxafQ8nl6HTX8cdyUqW+qwJJ+WZ+aJlv2/3fWnpXrM9vLDpX55dCP+62Oj+09OsKMMkePMqPs/g/G6g6WaS4NlVfO0t9d+873mXWkq5uqpWoRMVZLursFZBHRujZv4Ys9GWxbevOsa8fkjelUWXsp0o+udMub3TcuXRK+hkEsmNPnmqdQcNPmJMueuiwlb6+NnZLQRr+dLXxfSnp7iRQREduxcf6PHOflxXE/SttjmZfgNYFIX63kajlltb5N1lmyOthp2eYtcYn6Cf/YxKoUbRE7qz+5kXnjk+pd4e2LVGxvVZsWNFmk34LaHjzBm1pt8JenkhMuEnLKbLcwa+EiNm5LdpmZJbHYHycEjfRHIsblzfXLK+mO+G0bou8mfP5yUPhCq/RflQrFDDbLB4S3S/SzzAYgRGmh2pQaC8qib+QteAUAAJAZoD/hBSgTKRsBCCw2AgAKwGIB/wPYeg8k7CAcs4SQNASKQBfQhF4lMtRtwCN2HfiEPgRWWOQeLGYXOiRSRABCAYCwlgsUS/OBZm2IyFCXA4+j/cBn7TGwZL7aWSwwusHK06+JwqAt3shbvTHJNg16dGueM4gF9m6RYq+t+KvAdNSyIP9goFaTFkM6KfTDNwH7rd6/ICnTpN+AtkZvMSJFw9WE2WMio5sSi4zdzbuus2zAsBaxcpiDmuOa9aO+yzcXdpFs0qlTDnrrzf9IuyYNBkXCrajSgeGW2MHB5usPiqeuFacBmu9TB4HW/pfrlSpKlOaeg5EaxjTj9NDc3FhxfNW2y6ay0kAUnIqgzA2K0IQRNDZ1t7S3xTDHQNvZK+obBnqGBoZ6GtpG2xSZib627hYAAAA=) format('woff2'),
        url(data:application/font-woff;charset=utf-8;base64,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) format('woff'),
        url('iconfont.ttf') format('truetype'),
        url('iconfont.svg#iconfont') format('svg');
    font-weight: normal;
    font-style: normal;
}

  .card{
    -webkit-font-smoothing: antialiased;
    background-color:#fff;
    padding:25rpx 25rpx;
    margin-bottom:30rpx;
    overflow:hidden;
    color:#333;
    .title{
      font-size: 15pt;
      -webkit-line-clamp: 2;
      line-height: 1.2;
      overflow : hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .content-area{
      display: -webkit-box;
      .left-area{
        -webkit-box-orient: vertical;
        -webkit-box-flex: 1;
        .card-content{
          line-height: 1.3;
          font-size: 12pt;
          margin: 10rpx 0;
          font-family: HelveticaNeue-Light;
          overflow: hidden;
          color: #666;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
        }
        .info-area{
          font-size:10pt;
          color: #666;
          opacity:.8;
          font-family: 'iconfont';
          .grade:before{
            content: '\e65f';
            margin-right: 10rpx;
            font-size: 10pt;
          }
          .words{
            margin-left: 30rpx;
            &:before{
              content: '\e7b7';
              margin-right: 10rpx;
            }
          }
          .reviews{
            margin-left: 30rpx;
            &:before{
              content: '\e6cf';
              margin-right: 10rpx;
            }
          }
        }
      }
      .right-area{
        margin-left:20rpx;
      }
      .thumbnail{
        width:150rpx;
        height:150rpx;
        background-color: #eee;
        margin-top:26rpx;
      }
    }
  }

</style>
<template>
  <view class="container">
     <button type="primary" class="btn" @tap="loadTask()"> 登录 </button>
     <view class="swiperarea">
        <swiper indicator-dots="true" indicator-color="#fff" class='swiper' autoplay>
          <repeat for="{{swiperObjects}}">
            <swiper-item class="swiper-item">
              <text class="title_en">{{item.title_en}}</text>
              <image src="{{item.thumbnail_urls[0]}}" class="slide-image" mode='widthFix' @tap="tap({{item.id}})"/>
            </swiper-item>
          </repeat>
        </swiper>
      </view>
      <view class="line"></view>
      <view class="cards-area">
        <repeat for="{{detail.objects}}" >
          <view @tap="tap({{item.id}})" wx:if="{{item.id}}">
              <view class="card">
                <text class="title" >{{item.title_en}}</text>
                <view class="content-area">
                  <view class="left-area">
                    <text class="card-content" >{{item.summary}}</text>
                    <view class="info-area">
                      <text class="grade">{{item.grade_info}}</text>
                      <text class="words">{{item.length}}词</text>
                      <text class="reviews">{{item.num_reviews}}</text>
                    </view>
                  </view>
                  <view class="right-area">
                    <image src='{{item.thumbnail_urls[0]}}' class="thumbnail" mode="aspectFill"/>
                  </view>
                </view>
              </view>
          </view>
          <view class="date" wx:if="{{index!==0&&item.date!==detail.objects[index-1].date}}">{{item.date}}</view>
        </repeat>
      </view>
      <text class="info" wx:if="{{info}}">{{info}}</text>
      <image wx:else class="info loading" src="../assets/loading.gif"/>
  </view>
</template>

<script>
import wepy from 'wepy'
export default class Index extends wepy.page {
  config = {
    navigationBarTitleText: 'News Lite',
    window: {
      enablePullDownRefresh: true
    }
  }
  components = {}
  data = {
    detail: {
      objects: []
    },
    isLoadingMore: false,
    currentPage: 1,
    info: ''
  }
  computed={
    swiperObjects() {
      return this.data.detail.objects.slice(0, 5)
       // 轮播图只取5个，要不然太多了
    }
  }
  methods={
    tap(id) {
      wx.navigateTo({
        url: `/pages/three?id=${id}`
        // 打开一个新的同路由页面，但指定不同的数据初始值
      })
    },

    loadTask(){
    wx.showLoading({
      title: '加载中'
    });
    this.loadList()
    }
  }
  onLoad() {
    wx.showLoading({
      title: '加载中'
    });
    this.loadList();
  }
  onPullDownRefresh() {
    console.log(1)
    wx.stopPullDownRefresh()
  }
  onReachBottom() {
    this.currentPage++
    if (this.currentPage >= 10) {
      // 最多只能加载10页
      this.isLoadingMore = false
      this.info = 'No more news'
      this.$apply()
      return
    }
    this.isLoadingMore = true
    this.loadList()
  }
  onShareAppMessage() {
    return {
      title: 'News Lite',
      path: '/pages/index'
    }
  }
  loadList() {
    wx.request({
      url: `https://www.shanbay.com/api/v2/news/articles/?ipp=10&page=${this.currentPage}`,
      success: (res) => {
        if (res.data.msg === 'SUCCESS') {
          this.detail.objects = this.detail.objects.concat(res.data.data.objects)
        }
        this.$apply()
        wx.hideLoading()
      }
    })
  }
}
</script>
